{{- /* Code block with filename header and copy button
     Usage:
       {{< code-file name="config.py" >}}
       ```python
       API_KEY = os.environ["API_KEY"]
       ```
       {{< /code-file >}}
*/ -}}

{{- $name := .Get "name" | default "" -}}

<div class="code-block-wrapper">
  {{- if $name }}
  <div class="code-filename">
    <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor"><path d="M3.75 1.5a.25.25 0 00-.25.25v11.5c0 .138.112.25.25.25h8.5a.25.25 0 00.25-.25V6H9.75A1.75 1.75 0 018 4.25V1.5H3.75zm5.75.56v2.19c0 .138.112.25.25.25h2.19L9.5 2.06zM2 1.75C2 .784 2.784 0 3.75 0h5.086c.464 0 .909.184 1.237.513l3.414 3.414c.329.328.513.773.513 1.237v8.086A1.75 1.75 0 0112.25 15h-8.5A1.75 1.75 0 012 13.25V1.75z"/></svg>
    {{ $name }}
  </div>
  {{- end }}
  <button class="copy-btn" onclick="copyCode(this)" aria-label="Copy code">Copy</button>
  {{ .Inner | markdownify }}
</div>

{{ if not (.Page.Scratch.Get "copyScriptLoaded") }}
{{ .Page.Scratch.Set "copyScriptLoaded" true }}
<script>
function copyCode(btn) {
  const wrapper = btn.closest('.code-block-wrapper');
  const code = wrapper.querySelector('code');
  if (code) {
    navigator.clipboard.writeText(code.textContent).then(function() {
      btn.textContent = 'Copied';
      btn.classList.add('copied');
      setTimeout(function() {
        btn.textContent = 'Copy';
        btn.classList.remove('copied');
      }, 2000);
    });
  }
}
</script>
{{ end }}
